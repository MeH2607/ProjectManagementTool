<!DOCTYPE html>
<html lang="en">
<head>
    <title>Project</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.classless.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
          crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/project.css">


</head>
<body>
<div class="background" data-theme="light">
    <main class="container">
        <nav class="breadcrumb">
            <ol>
                <li class="breadcrumb-item"><a class="link-dark" href="/">Home</a></li>
                <li><a class="link-dark" href="/allprojects">All projects</a></li>
                <li role="list" dir="ltr">
                    <a class="link-dark" href="#" aria-haspopup="listbox">[[${project.name}]]</a>
                    <ul role="listbox">
                        <li th:each="project : ${projects}">
                            <a th:href="@{/project/{projectID}(projectID=${project.id})}" th:text="${project.name}"></a>
                        </li>
                    </ul>
                </li>
            </ol>
        </nav>
        <b type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop2" style="float: right">
            Create a new subproject
        </b>

        <div class="modal fade" id="staticBackdrop2" data-bs-backdrop="static" data-bs-keyboard="false"
             tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="staticBackdropLabel2">Create a new project</h1>
                    </div>
                    <div class="modal-body">
                        <form action="/createSubproject" method="post" th:object="${subproject}">
                            <div>
                                <label>Subproject name</label>
                                <input type="text" name="name" required>
                            </div>
                            <div>
                                <label>Subproject description</label>
                                <input type="text" name="description" required>
                            </div>
                            <div>
                                <label>Owner</label>
                                <select name="ownerID" required>
                                    <option value="" disabled selected>Select owner</option>
                                    <option th:each="user : ${all_users}" th:value="${user.id}" th:text="${user.name}" required>
                                        <input type="hidden" th:name="ownerID" th:value="${user.id}" />
                                    </option> <!-- th:selected="${user.id == project.owner.id}" -->
                                </select>
                            </div>
                            <div>
                                <br>
                                <label>Subproject deadline</label>
                                <input type="date" name="deadline"align="center" required>
                            </div>

                            <div class="modal-footer">
                                <button type="submit" class="btn btn-success">Create subproject</button>
                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>


        <h1 style="color: white; text-align: center" th:text="${project.name} "></h1>
        <div class="grid">
            <article th:each="subproject : ${subprojects}">
                <header style="background: rgb(227,226,226); text-align: center ">
                    <h2 th:text="${subproject.name}"></h2>
                    <progress th:value="${subproject.timeSpent}" th:max="${subproject.allocatedTime}"></progress>
                </header>
                <div>
                    <p class="card-text" th:text="${subproject.description}"></p><br>
                </div>
                <!-- Button trigger modal -->
                <a type="button" class="btn btn-primary" data-bs-toggle="modal"
                        data-bs-target="#staticBackdrop" style="float:right">
                    Create a new task
                </a>

                <table class="table table-striped" style="width: 70%">
                    <tbody>
                    <tr>
                        <td>Project Manager:</td>
                        <td><span th:text="${subproject.owner.name}"></span></td>
                        <!-- Det er denne som skal laves / fixes -->
                    </tr>
                    <tr>
                        <td>Allocated time:</td>
                        <td><span th:text="${subproject.timeSpent} + ' / '+ ${subproject.allocatedTime}"></span></td>
                    </tr>
                    <tr>
                        <td>Deadline:</td>
                        <td><span th:text="${subproject.deadline}"></span></td>
                    </tbody>
                </table>

                <!--
                make this work
                <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target=".multi-collapse" aria-expanded="false" aria-controls="multiCollapseExample1 multiCollapseExample2">Toggle both elements</button>
                -->


                <!-- Modal -->
                <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false"
                     tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="staticBackdropLabel">Create a new task</h1>
                            </div>
                            <div class="modal-body">
                                <form style="text-align: center;" action="#"
                                      th:action="@{${project.id} + '/create_task'}" method="post" th:object="${task}">
                                    <div style="color: white">

                                        <div>
                                            <input type="text" name="name" placeholder="Name" style="width: 100%;"
                                                   required>
                                        </div>
                                        <div>
                                            <input type="text" name="description" placeholder="Description"
                                                   style="width: 100%;" required>
                                        </div>
                                        <div>
                                            <input type="number" name="allocatedTime" placeholder="AllocatedTime"
                                                   style="width: 100%;" required>
                                        </div>
                                        <div>
                                            <input type="date" name="deadline" placeholder="deadline"
                                                   style="width: 100%;" required>
                                        </div>
                                        <div>
                                            <select name="ownerID" required>
                                                <option value="" disabled selected>Select Assignee</option>
                                                <option th:each="user : ${all_users}" th:value="${user.id}"
                                                        th:text="${user.name}">
                                                    <input type="hidden" th:name="ownerID" th:value="${user.id}"/>
                                                </option>
                                            </select>
                                        </div>
                                        <div>
                                            <label>ID</label>
                                            <input type="hidden" name="subprojectID" th:value="${subproject.id}"
                                                   style="width: 100%;" required>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-success">Create task</button>
                                            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">
                                                Cancel
                                            </button>
                                        </div>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>


                <!--Kanban element-->

                <div class="container">
                    <div class="row">

                        <!-- TO DO TASKS -->
                        <div class="col">
                            <div th:href="${subproject}">
                                <div class="card-body">
                                    <h3 class="text-center float-middle">TODO</h3>
                                </div>
                                <tr th:each="task : ${todo}" th:if="${task.subprojectID == subproject.id}">
                                    <section id="accordions" style="width: 100%">
                                        <details closed
                                                 th:class="${(task.status == 'Done') ? 'task-done' : ((task.status == 'Doing') ? 'task-doing' : 'task-not-started')}">

                                            <summary th:text="${task.name}" class="task-title"></summary>
                                            <p class="task-description" th:text="${task.description}"></p>
                                            <ul class="task-details">
                                                <p><span class="detail-text"
                                                         th:text="${'Allocated time: ' + task.allocatedTime}"></span>
                                                </p>
                                                <p><span class="detail-text"
                                                         th:text="${'Deadline: ' + task.deadline}"></span></p>
                                                <p><span class="detail-text"
                                                         th:text="${'Assigned: ' + task.owner.name}"></span></p>
                                                <!-- <p><span class="detail-text" th:text="${'task id' + task.id}" ></span></p> -->
                                            </ul>

                                            <!-- move -->
                                            <div class="card-body">
                                                <a href="#" class="card-link">...</a>
                                                <a href="#" class="card-link">Edit task</a>
                                                <a href="#" class="card-link">


                                                    <form th:action="@{${projectID} + '/moveTaskToDoing'}" method="post"
                                                          th:object="${task}">
                                                        <!-- The following value in th:value = taskID is sent to @requestparam in the controller
                                                        when the form is submitted
                                                        -->
                                                        <input type="hidden" th:name="taskId" th:value="${task.id}"/>
                                                        <button type="submit" class="card-link">DOING</button>
                                                    </form>

                                                </a>
                                            </div>

                                        </details>
                                    </section>
                                </tr>
                            </div>
                        </div>

                        <!-- DOING -->
                        <div class="col">
                            <div th:href="${subproject}">
                                <div class="col">

                                    <div class="card-body">
                                        <h3 class="text-center float-middle">DOING</h3>
                                    </div>

                                    <tr th:each="task : ${doing}" th:if="${task.subprojectID == subproject.id}">
                                        <section id="accordions" style="width: 100%">

                                            <details closed
                                                     th:class="${(task.status == 'Done') ? 'task-done' : ((task.status == 'Doing') ? 'task-doing' : 'task-not-started')}">

                                                <summary th:text="${task.name}" class="task-title"></summary>
                                                <p class="task-description" th:text="${task.description}"></p>
                                                <ul class="task-details">
                                                    <p><span class="detail-text"
                                                             th:text="${'Allocated time: ' + task.allocatedTime}"></span>
                                                    </p>
                                                    <p><span class="detail-text"
                                                             th:text="${'Deadline: ' + task.deadline}"></span></p>
                                                    <p><span class="detail-text"
                                                             th:text="${'Assigned: ' + task.owner.name}"></span></p>
                                                    <!-- <p><span class="detail-text" th:text="${'task id' + task.id}" ></span></p> -->
                                                </ul>

                                                <!-- move -->
                                                <div class="card-body">
                                                    <a href="#" class="card-link">

                                                        <form th:action="@{${projectID} + '/moveTaskToTodo'}"
                                                              method="post"
                                                              th:object="${task}">
                                                            <!-- The following value in th:value = taskID is sent to @requestparam in the controller
                                                            when the form is submitted
                                                            -->
                                                            <input type="hidden" th:name="taskId"
                                                                   th:value="${task.id}"/>
                                                            <button type="submit" class="card-link">TODO</button>
                                                        </form>

                                                    </a>
                                                    <a href="#" class="card-link">Edit task</a>
                                                    <a href="#" class="card-link">


                                                        <form th:action="@{${projectID} + '/moveTaskToDone'}"
                                                              method="post"
                                                              th:object="${task}">
                                                            <!-- The following value in th:value = taskID is sent to @requestparam in the controller
                                                            when the form is submitted
                                                            -->
                                                            <input type="hidden" th:name="taskId"
                                                                   th:value="${task.id}"/>
                                                            <button type="submit" class="card-link">DONE</button>
                                                        </form>

                                                    </a>
                                                </div>

                                            </details>
                                        </section>
                                    </tr>
                                </div>
                            </div>
                        </div>

                        <!-- DONE -->
                        <div class="col">
                            <div th:href="${subproject}">
                                <div class="status-column mb-3">

                                    <div class="card-body">
                                        <h3 class="text-center float-middle">DONE</h3>
                                    </div>

                                    <tr th:each="task : ${done}" th:if="${task.subprojectID == subproject.id}">
                                        <section id="accordions" style="width: 100%">

                                            <details closed
                                                     th:class="${(task.status == 'Done') ? 'task-done' : ((task.status == 'Doing') ? 'task-doing' : 'task-not-started')}">

                                                <summary th:text="${task.name}" class="task-title"></summary>
                                                <p class="task-description" th:text="${task.description}"></p>
                                                <ul class="task-details">
                                                    <p><span class="detail-text"
                                                             th:text="${'Allocated time: ' + task.allocatedTime}"></span>
                                                    </p>
                                                    <p><span class="detail-text"
                                                             th:text="${'Deadline: ' + task.deadline}"></span></p>
                                                    <p><span class="detail-text"
                                                             th:text="${'Assigned: ' + task.owner.name}"></span></p>
                                                    <!-- <p><span class="detail-text" th:text="${'task id' + task.id}" ></span></p>-->
                                                </ul>

                                                <!-- move -->
                                                <div class="card-body">
                                                    <a href="#" class="card-link">

                                                        <form th:action="@{${projectID} + '/moveTaskToDoing'}"
                                                              method="post"
                                                              th:object="${task}">
                                                            <!-- The following value in th:value = taskID is sent to @requestparam in the controller
                                                            when the form is submitted
                                                            -->
                                                            <input type="hidden" th:name="taskId"
                                                                   th:value="${task.id}"/>
                                                            <button type="submit" class="card-link">DOING</button>
                                                        </form>

                                                    </a>
                                                    <a href="#" class="card-link">Edit task</a>
                                                </div>

                                            </details>
                                        </section>
                                    </tr>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br>
                <a class="btn btn-link btn-block btn-sm" th:href="@{'/subproject/' + ${subproject.id}}">Show full
                    details</a>

            </article>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
                crossorigin="anonymous"></script>
    </main>
</div>
</body>
</html>
