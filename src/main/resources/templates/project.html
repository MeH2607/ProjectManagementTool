<!DOCTYPE html>
<html lang="en">
<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
          integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
          rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.classless.min.css" rel="stylesheet">
    <link href="/allprojects.css" rel="stylesheet" type="text/css">

</head>
<body>
<div class="background" data-theme="light">
    <main class="container">
        <!-- Navbar -->
        <nav class="breadcrumb">
            <ol>
                <li class="breadcrumb-item"><a class="link-dark" href="/">Home</a></li>
                <li><a class="link-dark" href="/allprojects">All projects</a></li>
                <li dir="ltr" role="list">
                    <a aria-haspopup="listbox" class="link-dark" href="#" style="background-color:#a6d6fd; height: 35px">[[${project.name}]]</a>
                    <ul role="listbox">
                        <li th:each="project : ${projects}">
                            <a th:href="@{/project/{projectID}(projectID=${project.id})}" th:text="${project.name}"></a>
                        </li>
                    </ul>
                </li>
                <li dir="ltr" role="list">
                    <a aria-haspopup="listbox" class="link-dark" href="#">Select subproject</a>
                    <ul role="listbox">
                        <li th:each="subproject : ${subprojects}">
                            <a th:href="@{/subproject/{subproject}(subproject=${subproject.id})}"
                               th:text="${subproject.name}"></a>
                        </li>
                    </ul>
                </li>
            </ol>
            <ol style="float: right; margin-right: 10px">
                <li class="breadcrumb-item"><a class="link-dark" href="/profile">Your profile</a></li>
                <li class="breadcrumb-item"><a class="link-dark" href="/logout">Logout</a></li>
            </ol>
        </nav>

        <!-- View of all subprojects for specific project -->
        <h1 style="text-align: center; color: white;"><a> All subprojects for [[${project.name}]] </a></h1>
        <b class="btn btn-primary btn-sm" data-bs-target="#staticBackdrop2" data-bs-toggle="modal" style="float: right"
           type="button">Create a new subproject
        </b>

        <!-- Sorting of subprojects -->
        <form method="get" th:action="@{/project/{projectID}(projectID=${project.id})} " th:object="${criteria}">
            <select name="criteria" style="width: 20%; background-color: white;">
                <option disabled selected value="">Select sorting criteria</option>
                <option th:each="criteria : ${sortCriterias}" th:text="${criteria}" th:value="${criteria}"></option>
            </select>
            <br>
            <button class="btn btn-primary btn-sm" style="width: 20%;  margin-top: 5px" type="submit">Sort</button>
        </form>

        <!-- Modal for creating a new subproject -->
        <div aria-hidden="true" aria-labelledby="staticBackdropLabel" class="modal fade" data-bs-backdrop="static"
             data-bs-keyboard="false" id="staticBackdrop2" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="staticBackdropLabel2">Create a new project</h1>
                    </div>
                    <div class="modal-body">
                        <form method="post" th:action="@{${project.id} + '/createSubproject'}"
                              th:object="${subproject}">
                            <div>
                                <label>Subproject name</label>
                                <input name="name" required type="text">
                            </div>
                            <div>
                                <label>Subproject description</label>
                                <input name="description" required type="text">
                            </div>
                            <div>
                                <label>Owner</label>
                                <select name="ownerID" required>
                                    <option disabled selected value="">Select owner</option>
                                    <option required th:each="user : ${all_users}" th:text="${user.name}" th:value="${user.id}">
                                        <input th:name="ownerID" th:value="${user.id}" type="hidden"/>
                                    </option>
                                </select>
                            </div>
                            <div>
                                <input name="projectID" required th:value="${project.id}" type="hidden">
                            </div>
                            <div>
                                <br>
                                <label>Subproject deadline</label>
                                <input name="deadline" required type="date">
                            </div>

                            <div class="modal-footer">
                                <button class="btn btn-success btn-sm" type="submit">Create subproject</button>
                                <button class="btn btn-danger btn-sm" data-bs-dismiss="modal" type="button">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- View of all subprojects -->

        <div class="grid">
            <article th:each="subproject : ${subprojects}">
                <header style="background: rgb(227, 226, 226); text-align: center; height: 120px;">
                    <h3 th:text="${subproject.name}"></h3>
                </header>
                <header style="background: rgb(243,243,243); text-align: center; height: 70px;">
                    <span th:text="'Progress: '+ ${subproject.timeSpent} +' / '+ ${subproject.allocatedTime} + ' hours'"></span>
                    <td><progress th:max="${subproject.allocatedTime}" th:value="${subproject.timeSpent}" style="height: 20px"></progress></td>
                </header>
                <header style="background: rgb(255,255,255); height: 100px;">
                    <p class="card-text" th:text="${subproject.description}"></p>
                </header>

                <div style="height: 140px;">
                    <table class="table table-striped">
                        <tbody>
                        <tr>
                            <td>Owner:</td>
                            <td><span th:text="${subproject.owner.name}"></span></td>
                        </tr>
                        <tr>
                            <td>Remaining workload </td>
                            <td><span th:text="${subproject.allocatedTimeInWorkdays} + ' days'"></span></td>
                        </tr>
                        <tr>
                            <td>Estimated daily workload until deadline:</td>
                            <td><span th:text="${subproject.hoursPerDayUntilDeadline} + ' hours/day'"></span></td>
                        </tr>
                        <tr>
                            <td>Deadline:</td>
                            <td><span th:text="${subproject.deadline}"></span></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <footer>
                    <a class="btn btn-link btn-block btn-sm" th:href="@{'/subproject/' + ${subproject.id}}">Show full details</a>
                </footer>
            </article>
        </div>


    </main>
</div>
<script crossorigin="anonymous"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>

